---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import { Card, CardGrid } from '@astrojs/starlight/components';
import tylerImage from '../assets/tyler.png';
interface BskyPost {
  text: string;
  createdAt: string;
  url: string;
  image?: string;
}

let posts: BskyPost[] = [];

try {
  const res = await fetch(
    'https://public.api.bsky.app/xrpc/app.bsky.feed.getAuthorFeed?actor=tylerstaut.com&limit=3'
  );
  if (res.ok) {
    const data = await res.json();
    posts = data.feed.map(({ post }: any) => {
      const rkey = post.uri.split('/').pop();
      const image =
        post.embed?.images?.[0]?.thumb ||
        post.embed?.media?.images?.[0]?.thumb;
      return {
        text: post.record.text,
        createdAt: post.record.createdAt,
        url: `https://bsky.app/profile/${post.author.handle}/post/${rkey}`,
        image
      };
    });
  }
} catch (err) {
  console.error('Failed to fetch Bluesky posts', err);
}

function formatDate(date: string) {
  return new Date(date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
}

const frontmatter = {
  title: 'Tyler Staut',
  description: 'Traveler • Hacker • CTF Junkie',
  template: 'splash',
  hero: {
    title: 'Hey! I\u2019m Tyler',
    tagline: 'Boldly going where no hacker has gone before<br />Probably doing a <a href="https://careerlimitingmaneuver.com" target="_blank" rel="noopener noreferrer">Career Limiting Maneuver</a>',
    image: { file: tylerImage, alt: 'Tyler Staut head-shot' },
    actions: [
      { text: 'Read my Blog', link: '/blog/', icon: 'rss', variant: 'secondary' },
      { text: 'Dive into my Docs', link: '/notes/', icon: 'right-arrow' }
    ]
  }
};
---
<StarlightPage frontmatter={frontmatter} hasSidebar={false}>
  <CardGrid stagger>
    <Card title="About" icon="information" href="/about/">
      I enjoy traveling, gaming, homelabbing, taking part in CTF's and generally working in tech/security.
      <br /><br />
      I am using this to help me on my journey and will include a lot of information I find useful.
      <br /><br />
      Whether you're here for tips on security or just curious about my projects, I hope you'll find something that sparks your interest!
    </Card>

    <Card title="Projects" icon="rocket" href="/projects/">
      A few things I’m building:
      <ul>
        <li>Cloudflare Workers</li>
        <li>Home lab project</li>
        <li>CTF write-ups</li>
        <li>Security tools</li>
        <li>Discord Bot stuff</li>
        <li>And more!</li>
      </ul>
    </Card>

    <Card title="Contact" icon="email" href="/contact/">
      <small style="display: flex; gap: 8px; align-items: center;">
        <a href="https://linkedin.com/in/Tyler-Staut" style="display: flex; align-items: center; gap: 4px;">
          <img src="https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/linkedin.svg" alt="LinkedIn" style="width: 16px; height: 16px;" /> LinkedIn
        </a> -
        <a href="https://github.com/Tyler-Staut" style="display: flex; align-items: center; gap: 4px;">
          <img src="https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/github.svg" alt="GitHub" style="width: 16px; height: 16px;" /> GitHub
        </a> -
        <a href="https://bsky.app/profile/tylerstaut.com" style="display: flex; align-items: center; gap: 4px;">
          <img src="https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/bluesky.svg" alt="Bluesky" style="width: 16px; height: 16px;" /> Bluesky
        </a>
      </small>
    </Card>
  </CardGrid>

  <section class="latest-posts">
    <h2>Latest Bluesky Posts</h2>
    {posts.length === 0 ? (
      <p>No Bluesky posts yet.</p>
    ) : (
      <CardGrid>
        {posts.map((post) => (
          <a
            class="bsky-card"
            href={post.url}
            style={post.image ? `background-image: url(${post.image})` : undefined}
          >
            <p>{post.text}</p>
            <time datetime={post.createdAt}>{formatDate(post.createdAt)}</time>
          </a>
        ))}
      </CardGrid>
    )}
    <p style="text-align: right;"><a href="https://bsky.app/profile/tylerstaut.com">View more →</a></p>
  </section>
</StarlightPage>

<style>
  .latest-posts {
    margin-top: 2rem;
  }

  .bsky-card {
    display: block;
    position: relative;
    border-radius: 0.5rem;
    overflow: hidden;
    padding: 1rem;
    color: var(--sl-color-white);
    text-decoration: none;
    background-color: var(--sl-color-gray-6);
    background-size: cover;
    background-position: center;
    box-shadow: var(--sl-shadow-sm);
  }
  .bsky-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
  }
  .bsky-card p,
  .bsky-card time {
    position: relative;
    margin: 0;
  }
  .bsky-card time {
    display: block;
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: var(--sl-color-gray-3);
  }
</style>
